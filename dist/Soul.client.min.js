/*! Soul 0.0.1 - MIT | git://github.com/souljs/soul.git */
(function(t,e){"use strict";function i(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function n(t,e,i,s,o,r){var a;s&&(s.fetch?s.isNew&&s.isNew()||(a=s.fetch(t.params)):"function"==typeof s?a=s.call(r||e,t.params):"object"==typeof s&&c(s,function(s,a){n(t,e[i],a,s,o,r||e)}),a&&a.then&&o.push(a.done(function(t){e[i]=t})))}var s=e.xtpl||t("../../js/xtpl"),o=e.jQuery||e.Zepto||e.ender||s&&s.$,r=e.Pilot||t("../../js/Pilot").Pilot,a=r.Class,u=function(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()},l="soul"+u(),h=o.map,c=r.utils.each,d=r.utils.extend,f=s.utils.filter,p=o.isArray,_=o.inArray,g=r.extend({__lego:function(t,e){e||(e=t,t={}),r.fn.__lego.call(this,d({el:null},t)),c(this._buildLayers(e),function(t,e){var i=t.id,n=t[404];t.opts.__group=t.group=t.group||0==e,this.route(i,t.path+(t.group?"*":""),t.ctrl||g.Layer,t.opts),n&&(n.opts.isActive=function(t){for(var e,i,s=0,o=t.length;o>s;s++)if(e=t[s],e.__404)i=e;else if(!e.__group)return!1;return i.id==n.id},n.opts.__404=!0,this.route(n.id,n.path+"*",n.view||n.ctrl||g.Layer,n.opts))},this),this.$apply=this.$apply.bind(this),this._$apply=this.$apply.bind(this,null),this.on("route",this._$apply),g.Hub.on("/public/*",this._$apply),g.Hub.on("/"+g.getSession()._id+"/*",this._$apply),g.Tabs.on("model.set",this._$apply),g.Tabs.on("model.save",this._$apply),g.Tabs.on("model.remove",this._$apply),g.GlobalEmitter.on("all",this._$apply)},_buildLayers:function(t,e){var i=t.id||u(),n={id:i,opts:{},path:e||"/"},s=[n];return c(t,function(t,o){if(/^(id|ctrl|group)$/.test(o))n[o]=t;else if(404==o)void 0===n.group&&(n.group=!0),n[o]=this._buildLayers(t,e)[0];else if(/^.?\//.test(o)){if(void 0===n.group&&(n.group=!0),"function"==typeof t){var r=t;t={onRoute:function(t,e){var n=this.router.get(i);r.call(n,e)}}}s.push.apply(s,this._buildLayers(t,((e||"/")+o).replace(/\/?\.?\/+/g,"/")))}else n.opts[o]=t},this),s},$:function(t){var e=this.items[0];return e.unit.$el.find(t)},$apply:function(){for(var t=this.items,e=t.length;e--;){var i=t[e].unit;i.active&&i.$apply&&i.$apply()}},getRoot:function(){return this.items[0].unit},run:function(t){this.start(t)}});g.ext=function(t){return d(g,t)},g.Layer=r.View.extend({tagName:"div",__lego:function(){var t=this;r.View.fn.__lego.apply(t,arguments),t.__model=t.model,t.__collection=t.collection,t.model=g.xtpl.utils.simpleClone(t.model),t.collection=g.xtpl.utils.simpleClone(t.collection),g.override(this,"init",function(){t.tpl&&t.tpl.bind(t.el,t),this.parent()})},__init:function(){r.View.fn.__init.apply(this,arguments),this.el&&!this.el.parentNode&&this.router.items[0].unit.$('[data-soul-view-id="'+this.id+'"]').append(this.el)},fn:function(t){return this.bound(t)},loadData:function(t){var e,i=[],s=this.tpl,o=this.el;if(void 0===s&&"string"==typeof o&&(e=jQuery(o),"text/xtpl"===e.attr("type"))){var r=document.createElement("div");e.before(r),this.el=r,this.tpl=s=o,r=null}return o=e=null,"string"==typeof s&&i.push(g.loadTpl(s).done(this.fn(function(t){this.tpl=t}))),n(t,this,"model",this.__model,i),n(t,this,"collection",this.__collection,i),g.when(i)}}),g.ext({host:location.host+":8001",baseUrl:"./app/",$:o,xtpl:s,Pilot:r,Class:a,uid:u,map:s.utils.map,each:c,extend:d,filter:f,inArray:_,isArray:p,expando:l,access:r.access,throttle:s.utils.throttle,qs:r.utils.qs,defer:t("Soul.defer"),http:t("Soul.http"),Hub:t("Soul.Hub"),Tabs:t("Soul.Tabs"),Emitter:t("Soul.Emitter"),Model:t("Soul.Model"),Collection:t("Soul.Collection"),Storage:t("Soul.Storage"),create:function(t,e){return new g(t,e)},getter:function(t,e,i){var n={};(i||g)[t]=e.bind(n)},override:function(t,e,i){var n=t[e];t[e]=function(){var t,e=this.parent;return this.parent=n,t=i.apply(this,arguments),this.parent=e,t}},use:function(t,e){return"string"==typeof t&&void 0===e?window.require("app"===t?t:t.split(".").join("/")+"/"+t):(t instanceof Array&&(t=h(t,function(t){return-1!=t.indexOf("/")||"app"===t?t:(t.split(".").join("/")+"/"+t).replace(/\/spec\//g,"/")})),window.require(t,e))},define:function(t,e){e||(e=t,t=[]),(""+e).replace(/Soul\.(use|getModel|getCollection)\s*\(\s*["']([^'"\s]+)["']\s*\)/g,function(e,i,n){return"use"!=i&&(n+=".spec"),t[n]||(t[n]=1,t.push(n)),e}),define(h(t,function(t){return-1!=t.indexOf("/")||"app"===t?t:(t.split(".").join("/")+"/"+t).replace(/\/spec\//g,"/")}),e)}}),g.getter("loadTpl",function(t){var e=this,i=e[t],n=/^#/.test(t);return i||(i=g.defer(),n?i.resolve(o(t).remove().prop("innerHTML")):i=g.ajax(g.baseUrl+t).pipe(function(t){return t.body}),e[t]=i=i.pipe(function(e){var i=s.compile(e,t);return{bind:function(t,e){s.bind(t,i,e)}}})),i}),s.autoInit=!1,e.Soul=g})("undefined"==typeof require?function(){}:require,"undefined"==typeof exports?window:exports),function(t){"use strict";function e(){return this instanceof e?(this._ok=!0,this._err=!0,this._end=!1,this._done=[],this._fail=[],this._progress=[],this.done=this.done.bind(this),this.fail=this.fail.bind(this),this.then=this.then.bind(this),this.pipe=this.pipe.bind(this),this.always=this.always.bind(this),this.reject=this.reject.bind(this),this.resolve=this.resolve.bind(this),this.notify=this.notify.bind(this),this.progress=this.progress.bind(this),this._getSelf=this._getSelf.bind(this),void 0):e.create()}function i(t,e,i){var n=e(i);n&&n.promise?n.then(this.resolve,this.reject):this[t](n)}e.prototype={constructor:e,_getSelf:function(){return this},notify:function(){for(var t=arguments,e=this._progress,i=0,n=e.length;n>i;i++)e[i].apply(this,t);return this},progress:function(t){return t&&!this._end&&this._progress.push(t),this},then:function(t,e,i){return this.done(t).fail(e).progress(i)},always:function(t){return this.then(t,t)},done:function(t){return this._ok&&t&&(this._end?t(this._data):this._done.push(t)),this},fail:function(t){return this._err&&t&&(this._end?t(this._data):this._fail.push(t)),this},reject:function(t){this.reject=this._getSelf;var e=this._fail;for(this._ok=!1,this._end=!0,this._done=[],this._data=t;e.length;)e.shift()(t);return this},resolve:function(t){this.resolve=this._getSelf;var e=this._done;for(this._err=!1,this._end=!0,this._fail=[],this._data=t;e.length;)e.shift()(t);return this},promise:function(){return void 0===this._promise&&(this._promise={done:this.done,fail:this.fail,then:this.then,pipe:this.pipe,always:this.always,reject:this._getSelf,resolve:this._getSelf,notify:this.notify,progress:this.progress,promise:this.promise,_promise:this._promise}),this._promise},pipe:function(t,n){var s=e();return this.then(i.bind(s,"resolve",t),i.bind(s,"reject",n),s.notify),s.promise()}},e.create=function(){return new e},e.when=function(t){var i=e(),n=[];n=t instanceof e?arguments:t;var s=0,o=n.length,r=o,a=[],u=function(t){a.push(t),++s==o&&i.resolve(a)};if(o)for(;r--;)n[r].then(u,i.reject);else i.resolve(a);return i.promise()},t.defer=e,t.when=e.when}("undefined"!=typeof Soul?Soul:exports),function(t){var e,i=t.$,n=t.extend,s={},o=function(i,s,r,a,u){return"string"==typeof s&&/^(get|post|put|delete)$/i.test(s)||(u=a,a=r,r=s,s="get"),"function"==typeof a&&(u=a,a=void 0),a&&a.processData===!1&&(r=JSON.stringify(r)),a=a||{},a.headers=a.headers||{},t.User.sessionToken&&(a.headers["X-Parse-Session-Token"]=t.User.sessionToken),e(n({url:i,type:s,dataType:"text",data:r},a)).pipe(o.parse,o.parse).always(u)};t.each(["get","post","put","delete"],function(e){o[e]=function(i,n,s,o){return t.http(i,e,n,s,o)}}),o.mock=function(t){s[(t.type||"get")+" "+t.url]=t},i&&i.ajaxSettings&&(e=i.ajax,i.ajaxSettings.responseFields.body="body",i.ajaxPrefilter(function(t){var e=s[t.type+" "+t.url];return e&&"mock"}),i.ajaxSetup({converters:{"* mock":!0}}),i.ajaxTransport("mock",function(t){return{send:function(e,i){var n=s[t.type.toLowerCase()+" "+t.url.split("?")[0]],o=n.result,r=n.sleep||50*Math.random(),a=o.status,u=o.statusText||(200==a?"OK":"Error");t.async&&-1!=r?setTimeout(function(){i(a,u,o)},0|r):i(a,u,o)}}})),o.Result=t.Class({body:{},result:{},status:null,statusText:"unknown",responseText:null,__lego:function(t){var e,n=this.responseText=t.responseText;if(this.xhr=t,this.status=t.status,this.statusText=t.statusText,200==t.status||201===t.status)if(/^\s*{/.test(n)||t.body)try{e=this.result=t.body?t.body:i.parseJSON(n),this.body=e}catch(s){this.status=o.PARSE_ERROR,this.statusText=""+s}else this.body=n},isOK:function(){return 200==this.status||201==this.status},isErr:function(){return!this.isOK()},getBody:function(){return this.body}}),n(o,{OK:200,PARSE_ERROR:500,parse:function(e,i,n){var s=new o.Result(n);return t.defer()[s.isOK()?"resolve":"reject"](s)}}),t.http=t.ajax=o}(Soul),function(t){var e=t.inArray,i=function(t,e){var i=t.__listeners__;return void 0===i&&(i=t.__listeners__={}),void 0!==e&&(i=i[e],void 0===i&&(i=t.__listeners__[e]=[])),i},n=t.Class({__lego:function(){},on:function(t,e,n){return"string"==typeof e&&(n=this[e],e=this),n=n?n.bind(e):e,i(this,t).push(n),this},off:function(t,n){"string"==typeof n&&(n=this[n]);var s=i(this,t),o=e(s,n);return o>-1&&s.splice(o,1),this},one:function(t,e,i){return"string"==typeof e&&(i=this[e],e=this),this.on(t,function n(){this.off(t,n),i.apply(e,arguments)})},emit:function(t,e){var n=i(this,t),s=n?n.length:0;if("array"!=typeof e&&(e=[e]),1===e.length)for(e=e[0];s--;)n[s].call(this,e);else for(;s--;)n[s].apply(this,e)}});n.getListeners=i,t.Emitter=n;var s=t.GlobalEmitter=new n;s.emit=t.throttle(s.emit,30,s)}(Soul),function(t){var e=t.uid,i=t.extend,n=t.GlobalEmitter,s=t.Emitter.extend({url:"/ajax/{model}/",idAttr:"id",defaults:null,name:null,storage:null,collection:null,__lego:function(t,n){var s=this.storage;void 0!==n&&(this.collection=n.collection,s=s||n.collection.storage),this.cid=e(),this.attrs=this.attributes=i({},this.defaults),this.options=n,this.storage=s,this.set(t||{},!1)},isNew:function(){return null==this.id},getSharedId:function(){var t=this;return this.get("shared_id")||t.collection&&t.collection.getSharedId(t)},set:function(t,e){var i,s,o=[],r={},a=this.attrs,u="string"!=typeof t&&e===!1||e&&e.silent;if(!e||0!=e.sync,"string"==typeof t)a[t]!==e&&(o.push(t),r[t]=a[t]=e);else for(i in t)s=t[i],s!==a[i]&&(o.push(i),r[i]=a[i]=s);return void 0!==r[this.idAttr]&&(this.id=r[this.idAttr]),o.length&&(this.changed=!0,this.changedAttrs=r,u||(this.emit("change"),this.emit("all"),n.emit("all"))),this},inc:function(t,e){void 0===e&&(e=1);var i=0|this.get(t);return this.set(t,i+~~e)},dec:function(t){return this.inc(t,-1)},get:function(t){return this.attrs[t]},fetch:function(){var e=this,i=e.url.replace("{model}",this.name)+"/"+this.id+"/",n=e.__promise;return n===!0?n=t.defer().resolve(e):n||(n=t.ajax(i,null,e.request).pipe(function(t){return e.set(t.body)})),e.__promise=n},toJSON:function(){return this.attrs},pack:function(t){return{id:this.id,name:this.name,attrs:t||this.toJSON(),collection:this.collection&&this.collection.nsname}},clone:function(){var t=new this.__self(this.toJSON(),this.options);return t.changed=this.changed,t},clear:function(){return this.attrs=this.attributes={},this.changed=!1,this.set(this.defaults),this},getStorage:function(){var e=this.storage;return e&&t.getStorage(e,this.name)},remove:function(e){var i=this.getStorage(),n=this.collection,s=!e||0!=e.sync;i&&i.remove(this.id),n&&n.remove(this),s&&t.Tabs.emit("model.remove",{id:this.id,name:this.name}),this.__self.remove(this.id)},save:function(e){if(e=e||{},this.changed){this.changed=!1;var i,s=this,o=s.collection,r=s.getStorage();if(r)void 0===s.id&&(s.attrs[s.idAttr]=s.id=s.cid),i=r.set(s.id,s);else if(s.url&&s.storage!==!1){var a=s.url.replace("{model}",s.name);i=this.isNew()?t.ajax.post(a,this.toJSON(),s.request):t.ajax.put(a+"/"+s.id,s.changedAttrs,s.request),i.pipe(function(t){s.set(t.body),s.changed=!1,delete s.changedAttrs})}else i=t.defer().resolve();return i.pipe(function(){return n.emit("all"),t.Tabs.emit("model.save",s.pack()),t.Hub.shareModel(s,e.shareTo),o&&o.set(s),s}).fail(function(){s.changed=!0})}return t.defer().resolve(this)}});s.eq=function(t){return s.fetch.bind(this,t)},s.byReq=function(t){var e=this;return"function"==typeof t?t.bind(e):t?function(i){var n,s={};for(n in i)s[t[n]||n]=i[n];return e.fetch(s)}:e},s.spec=function(t,e){if("string"==typeof t){if(void 0===e)return this.fn[t];this.fn[t]=e}else e||(e=t,t={}),i(this,t),i(this.fn,e);return this},s.create=function(t){return new this(t)},s.get=function(t,e){var i=this,n=i.fn.idAttr,s=i.models=i.models||{},o=s[t];return void 0===e?e={}:void 0!==e.idAttr&&void 0!==e.attrs&&(s[t]=o=e,e=null),void 0===o?(e[n]=t,s[t]=o=new i(e)):null!=e&&o.set(e),o},s.upd=function(t,e){return this.get(t).set(e,{sync:!1})},s.remove=function(t){var e=this.models,i=e&&e[t];i&&delete e[t]},s.set=function(e,i){var n=this.get(e,i);return n.set(i),n.__promise=t.defer().resolve(n),this},s.fetch=function(t){var e=t,i=this.fn.idAttr;return void 0!==t[i]&&(e=t[i]),this.get(e).fetch()},s.unpack=function(e){var i=t.getModel(e.name).upd(e.id,e.attrs),n=e.collection;return n&&(i.collection=t.getCollection(n).set(i)),i},t.getter("getModel",function(t){var e=this,i=e[t];return void 0===i&&(i=e[t]=s.extend({name:t})),i}),t.Model=s}(Soul),function(t){var e=t.each,i=t.extend,n=t.isArray,s=t.Model,o=t.Emitter,r=t.GlobalEmitter,a=o.extend({model:s,__lego:function(t){this.reset(),n(t)&&this.set(t)},reset:function(t){var e=this.length;if(e>0)for(;e--;)delete this[e];this[0]=void 0,this._idx={},this.length=0,this.models=[],n(t)&&this.add(t),this.emit("change"),r.emit("all")},each:function(t){return e([].concat(this.models),t),this},filter:function(t){return this.models.filter(t)},eq:function(t){return this.models[t]},get:function(t){return this._idx[t]},add:function(t){e([].concat(t),function(t){var e=this.model,i=t.cid,n=t.id||t[e.fn.idAttr],s=this._idx[i],o=!1;void 0===s&&(s=this._idx[n]),void 0===s?(s=e.get(n,t),s.__promise=!0,s.collection=this,s.storage=s.storage||this.storage,s.on("change",this.emit.bind(this,"change")),this.length=this.models.push(s),this[this.length-1]=s,o=!0):s!==t&&s.set(t),this._idx[s.cid]=s,null!=s.id&&(this._idx[s.id]=s),o&&(this.emit("add",s),this.emit("change"),r.emit("all"))},this);var i=this.comparator;return i&&(this.models=this.models.sort(i)),this},set:function(t){return this.add(t)},def:function(t){return this.defaults=t,this},byReq:function(t,e){return this.def(e),s.byReq.call(this,t)},newModel:function(e){var i=this;return function(){return t.defer().resolve(new i.model(e,{collection:i}))}},create:function(t){return new this.model(t,{collection:this})},where:function(t){return this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},remove:function(e){var i=this.models.indexOf(e);return~i&&(this.models.splice(i,1),this.length--,this.storage&&t.getStorage(this.storage,this.model.fn.name).remove(e.id),this.emit("change")),this},fetch:function(e,n){n=n||{};var s=this,o=JSON.stringify(e),r=s.model,a=r.fn.url&&r.fn.url.replace("{model}",r.fn.name),u=s.__defer,l=s.storage&&t.getStorage(s.storage,r.fn.name);return(!u||n.force||u&&u.key!=o)&&(u=l?l.getAll().pipe(function(t){return n.reset&&s.reset(),s.add(t)}):a?t.ajax(a,i({},s.defaults,e),i({},r.fn.request,{processData:!0})).pipe(function(t){return n.reset&&s.reset(),t.body.count&&(s.totalLength=t.body.count),s.add(t.body.results)}):t.defer().resolve(s),s.__defer=u.promise(),u.key=o),u},toJSON:function(){return this.models},getSharedId:function(){},spec:function(t,e){if("string"==typeof t){if(void 0===e)return this[t];this[t]=e}else i(this,t);return this.onAdd&&(this.on("add","onAdd"),delete this.onAdd),this}});t.getter("getCollection",function(e){var i=this,n=e.split(".")[0],s=i[e];return void 0===n?s=new a:void 0===s&&(s=i[e]=new(a[n]||a.extend({model:t.getModel(n)})),s.nsname=e),s}),t.Collection=a}(Soul),function(t){var e=t.uid,i=t.each,n=t.extend,s=t.inArray,o=t.Class({__lego:function(t,e){this.name=t,this._data={},this.options=e},_key:function(t){return t},_get:function(t){return this._data[t]},_getAll:function(){var t=[];return i(this.data,function(e){t.push(e)}),t},_set:function(t,e){this._data[t]=e},_remove:function(t){delete this._data[t]},_promise:function(e,i){return this.options&&this.options.sync?e:e&&e.promise?e:t.defer()[null!=e||i?"resolve":"reject"](e)},get:function(t){var e=this._get(this._key(t));return this._promise(e)},getAll:function(){var t=this._getAll();return this._promise(t)},set:function(t,e){e&&e.toJSON&&(e=e.toJSON());var i=this._set(this._key(t),e);return this._promise(i,!0)},remove:function(t){var e=this._remove(this._key(t));return this._promise(e,!0)}});o.runtime=o,o.local=o.extend({__lego:function(){o.fn.__lego.apply(this,arguments),this.keys=this._get(this._key("keys"))||[]},_key:function(t){return"soul."+this.name+"."+t},_keyIdx:function(t){return s(this.keys,t)},_updKeys:function(){localStorage.setItem(this._key("keys"),JSON.stringify(this.keys))},_get:function(t){var e=localStorage.getItem(t);return"undefined"===e?void 0:e&&JSON.parse(e)},_getAll:function(){var t=[];return i(this.keys,function(e){t.push(this._get(e))},this),t},_set:function(t,e){-1==this._keyIdx(t)&&(this.keys.push(t),this._updKeys()),localStorage.setItem(t,JSON.stringify(e))},_remove:function(t){var e=this._keyIdx(t);e>-1&&(this.keys.splice(e,1),localStorage.removeItem(t),this._updKeys())}}),o.soul=o.extend({_res:function(t){return t.body},_req:function(e,i,n){return t.ajax("//"+t.host+"/cache/soul/"+this.name+"/"+e,i,"json="+JSON.stringify(n)).pipe(this._res)},_getAll:function(){return this._req("all")},_get:function(t){return this._req(t)},_set:function(t,e){return this._req(t,"POST",e)},_remove:function(t){return this._req(t,"DELETE")}}),o.mongolab=o.extend({_req:function(t,e,i){var n=this.options;return $.ajax({url:"https://api.mongolab.com/api/1/databases/"+n.db+"/collections/"+this.name+(e?"/"+e:"")+"?apiKey="+n.apiKey,data:i&&JSON.stringify(i),type:t,dataType:"json",contentType:"application/json"})},_get:function(t){return this._req("GET",t)},_getAll:function(){return this._req("GET")},_set:function(t,e){return this._req("PUT",t,e).pipe(function(t){return t._id})},_remove:function(t){return this._req("DELETE",t)}}),o.session=o.local.extend({__lego:function(){o.local.fn.__lego.apply(this,arguments);var t=this.get("__id__")||{id:e(),_id:e(),sharedId:e()};n(this,t),this.set("__id__",t)}}),t.getter("getStorage",function(e,i){var n=this,s=e+i,r=e.split("?");return n[s]=n[s]||new o[r[0]](i,t.qs.parse(r[1]))}),t.getSession=function(){return t.getStorage("session?sync=true","__session__")},t.session=function(e,i){var n=t.getSession();return e?n[e]||n[void 0===i?"get":"set"](e,i):n},t.Storage=o}(Soul),!this.Soul&&this.importScripts&&importScripts("Soul.js","Soul.Emitter.js"),function(t){var e=t.each,i=t.filter,n=t.expando,s=t.Emitter.getListeners,o=window.document,r=0,a=void 0===o,u=[],l=new(t.Emitter.extend({_idx:0|localStorage.getItem("__soul__.idx"),__lego:function(){if(r){var e=this.port=new r(o.scripts[o.scripts.length-1].src).port;e.addEventListener("message",this._onMessage,!1),e.start()}else window.addEventListener("storage",this._onStorage.bind(this),!1);this.on("model.set",function(e){console.log("tabs.model.set:",e),t.getModel(e.name).upd(e.id,e.attrs)}),this.on("model.save",function(e){console.log("tabs.model.save:",e),t.Model.unpack(e)}),this.on("model.remove",function(e){console.log("model.remove:",e),t.getModel(e.name).get(e.id).remove({sync:!1})})},_onMessage:function(t){console.log("_onMessage:",t)},_onStorage:function(){var t=this._idx,i=t;e(s(this),function(t,s){var o=localStorage.getItem("__soul__."+s),r=t.length,a=this._idx;e(o&&JSON.parse(o)||[],function(e){if(e.tid!=n&&e.idx>a)for(;r--;)t[r].call(window,e.data),i=Math.max(e.idx,i)},this)},this),this._idx=i},emit:function(t,e){this.port.postMessage({tid:n,ts:+new Date,type:t,data:e})}}));a?(window.onconnect=function(t){for(var e=t.ports,i=e.length;i--;)u.push(e[i]),e[i].start(),e[i].postMessage("READY")},window.onmessage=function(t){for(var e=u.length;e--;)u[e].postMessage(t.data)}):r||(l.emit=function(t,e){console.log("emit:",t,e);var s="__soul__."+t,o=localStorage.getItem(s),r=+new Date,a=localStorage.getItem("__soul__.idx")||0;o=i(o&&JSON.parse(o)||[],function(t){return r-t.ts>3e3}),o.push({tid:n,ts:r,idx:++a,type:t,data:e}),localStorage.setItem("__soul__.idx",a),localStorage.setItem(s,JSON.stringify(o))}),t.Tabs=l}(Soul),function(t){var e=t.Model,i=t.$,n=t.expando,s=new(t.Class({host:t.host,mount:"/faye",__lego:function(){if(!window.Faye)return this.on=this.off=this.emit=i.noop,console.warn("Faye is not defined"),void 0;var o=location.protocol+"//"+this.host;this.client=new Faye.Client(o+this.mount),this.client.addExtension({incoming:function(t,e){/__model__/.test(t.channel)&&t.data&&t.data.tid==n&&(t.channel="/dev/null"),s.token=t.token,e(t)},outgoing:function(e,i){var n=t.getSession();e.session={id:n.id,_id:n._id,token:s&&s.token,sharedId:n.sharedId},i(e)}}),this.on("/public/__model__",function(t){e.unpack(t.model)}),this.on("/"+t.getSession()._id+"/__model__",function(e){var i=e.model,n=t.getModel(i.name),s=t.getCollection(e.model.collection);(n.spec("share")||s.spec("share"))&&n.unpack(e.model)})},shareModel:function(t,e){var i=t.share||t.collection&&t.collection.share;i&&(i=!0===i?"public":i,s.emit("/"+i+"/__model__",{tid:n,type:i,model:t.pack(),shareTo:e||t.getSharedId()}))},emit:function(t,e){console.log("Hub.emit:",t,e),this.client.publish(t,e)},on:function(t,e){console.log("Hub.on:",t),this.client.subscribe(t,e)},off:function(t,e){this.client.unsubscribe(t,e)}}));t.Hub=s}(Soul),function(t){function e(e){var n=(i=e).toJSON();return n.sessionToken=s.sessionToken,t.session("_user",n),i}var i,n=(t.defer,t.extend),s=t.getModel("_user").spec({url:"https://api.parse.com/1/users/",idAttr:"objectId",request:{headers:{"X-Parse-REST-API-Key":"0iAtjkrIIAc1X3HuOAYPWy4CDC8wuYKIuMStdfwi","X-Parse-Application-Id":"zm7HTaHs6pEy4L8T1RBqiblLFEytpmZnhL2oIL4V"},processData:!1,contentType:"application/json"},set:function(e,i){return"object"==typeof e&&void 0!==e.sessionToken&&(s.sessionToken=e.sessionToken,delete e.sessionToken),t.Model.fn.set.call(this,e,i)},save:function(){return t.Model.fn.save.call(this).done(function(){e(this)}.bind(this))},logOut:function(){}});s.isAuth=function(){return null!==s.current()},s.current=function(){return i},s.logIn=function(i,o){return t.ajax("https://api.parse.com/1/login",{username:i.toLowerCase(),password:o},n(s.fn.request,{processData:!0})).done(function(t){e(s.create(t.body))})},s.signUp=function(t,i,o){var r=s.create(n({username:t.toLowerCase(),email:t,password:i},o));return r.save().done(function(){e(r)})},i=function(){var i=t.session("_user");return i?e(s.create(i)):null}(),t.User=s}(Soul);